{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///D:/conversational-mirror-asd/src/lib/mongodb.ts"],"sourcesContent":["import { MongoClient } from \"mongodb\";\r\n\r\nif (!process.env.MONGODB_URI) {\r\n  throw new Error('Invalid/Missing environment variable: \"MONGODB_URI\"');\r\n}\r\n\r\nconst uri = process.env.MONGODB_URI;\r\nconst options = {};\r\n\r\nlet client: MongoClient;\r\nlet clientPromise: Promise<MongoClient>;\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  // In development mode, use a global variable to preserve the value \r\n  // across module reloads caused by HMR (Hot Module Replacement).\r\n  let globalWithMongo = global as typeof globalThis & {\r\n    _mongoClientPromise?: Promise<MongoClient>;\r\n  };\r\n\r\n  if (!globalWithMongo._mongoClientPromise) {\r\n    client = new MongoClient(uri, options);\r\n    globalWithMongo._mongoClientPromise = client.connect();\r\n  }\r\n  clientPromise = globalWithMongo._mongoClientPromise;\r\n} else {\r\n  // In production mode, it's best to avoid using a global variable.\r\n  client = new MongoClient(uri, options);\r\n  clientPromise = client.connect();\r\n}\r\n\r\n// Export a module-scoped MongoClient promise. \r\n// By doing this, the client can be shared across all Server Actions.\r\nexport default clientPromise;"],"names":[],"mappings":";;;;AAAA;;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,WAAW,EAAE;IAC5B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AACnC,MAAM,UAAU,CAAC;AAEjB,IAAI;AACJ,IAAI;AAEJ,wCAA4C;IAC1C,oEAAoE;IACpE,gEAAgE;IAChE,IAAI;IAIJ,IAAI,CAAC,gBAAgB,mBAAmB,EAAE;QACxC,SAAS,IAAI,oKAAW,CAAC,KAAK;QAC9B,gBAAgB,mBAAmB,GAAG,OAAO,OAAO;IACtD;IACA,gBAAgB,gBAAgB,mBAAmB;AACrD;;uCAQe"}},
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":["file:///D:/conversational-mirror-asd/src/auth.ts"],"sourcesContent":["import NextAuth from \"next-auth\";\r\nimport Credentials from \"next-auth/providers/credentials\";\r\nimport clientPromise from \"@/lib/mongodb\";\r\nimport bcrypt from \"bcryptjs\";\r\n\r\nexport const { handlers, auth, signIn, signOut } = NextAuth({\r\n  providers: [\r\n    Credentials({\r\n      name: \"Credentials\",\r\n      async authorize(credentials) {\r\n        if (!credentials?.email || !credentials?.password) return null;\r\n\r\n        const client = await clientPromise;\r\n        const db = client.db(\"mirrorDB\");\r\n        \r\n        // Find user by email\r\n        const user = await db.collection(\"users\").findOne({ \r\n          email: (credentials.email as string).toLowerCase() \r\n        });\r\n\r\n        if (!user || !user.password) return null;\r\n\r\n        // Verify password\r\n        const isPasswordCorrect = await bcrypt.compare(\r\n          credentials.password as string,\r\n          user.password\r\n        );\r\n\r\n        if (!isPasswordCorrect) return null;\r\n\r\n        // Return the user object with lifeStage included\r\n        // This object is passed to the 'jwt' callback below as 'user'\r\n        return {\r\n          id: user._id.toString(),\r\n          name: user.name,\r\n          email: user.email,\r\n          lifeStage: user.lifeStage, \r\n        };\r\n      },\r\n    }),\r\n  ],\r\n  callbacks: {\r\n    // 1. JWT Callback: Persists the lifeStage into the encrypted token\r\n    async jwt({ token, user }) {\r\n      if (user) {\r\n        token.id = user.id as string;\r\n        token.lifeStage = user.lifeStage;\r\n      }\r\n      return token;\r\n    },\r\n    // 2. Session Callback: Makes the data available to your Server & Client components\r\n    async session({ session, token }) {\r\n      if (session.user) {\r\n        session.user.id = token.id;\r\n        session.user.lifeStage = token.lifeStage as string;\r\n      }\r\n      return session;\r\n    },\r\n  },\r\n  pages: {\r\n    signIn: \"/login\",\r\n  },\r\n  session: {\r\n    strategy: \"jwt\",\r\n  },\r\n});"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AAAA;AACA;AACA;;;;;AAEO,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,GAAG,IAAA,gKAAQ,EAAC;IAC1D,WAAW;QACT,IAAA,qKAAW,EAAC;YACV,MAAM;YACN,MAAM,WAAU,WAAW;gBACzB,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU,OAAO;gBAE1D,MAAM,SAAS,MAAM,gIAAa;gBAClC,MAAM,KAAK,OAAO,EAAE,CAAC;gBAErB,qBAAqB;gBACrB,MAAM,OAAO,MAAM,GAAG,UAAU,CAAC,SAAS,OAAO,CAAC;oBAChD,OAAO,AAAC,YAAY,KAAK,CAAY,WAAW;gBAClD;gBAEA,IAAI,CAAC,QAAQ,CAAC,KAAK,QAAQ,EAAE,OAAO;gBAEpC,kBAAkB;gBAClB,MAAM,oBAAoB,MAAM,4IAAM,CAAC,OAAO,CAC5C,YAAY,QAAQ,EACpB,KAAK,QAAQ;gBAGf,IAAI,CAAC,mBAAmB,OAAO;gBAE/B,iDAAiD;gBACjD,8DAA8D;gBAC9D,OAAO;oBACL,IAAI,KAAK,GAAG,CAAC,QAAQ;oBACrB,MAAM,KAAK,IAAI;oBACf,OAAO,KAAK,KAAK;oBACjB,WAAW,KAAK,SAAS;gBAC3B;YACF;QACF;KACD;IACD,WAAW;QACT,mEAAmE;QACnE,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,IAAI,MAAM;gBACR,MAAM,EAAE,GAAG,KAAK,EAAE;gBAClB,MAAM,SAAS,GAAG,KAAK,SAAS;YAClC;YACA,OAAO;QACT;QACA,mFAAmF;QACnF,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,IAAI,QAAQ,IAAI,EAAE;gBAChB,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;gBAC1B,QAAQ,IAAI,CAAC,SAAS,GAAG,MAAM,SAAS;YAC1C;YACA,OAAO;QACT;IACF;IACA,OAAO;QACL,QAAQ;IACV;IACA,SAAS;QACP,UAAU;IACZ;AACF"}},
    {"offset": {"line": 114, "column": 0}, "map": {"version":3,"sources":["file:///D:/conversational-mirror-asd/src/actions/analytics.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { auth } from \"@/auth\";\r\nimport clientPromise from \"@/lib/mongodb\";\r\n\r\nexport async function getOverallAnalytics() {\r\n  const session = await auth();\r\n  if (!session?.user) throw new Error(\"Unauthorized access to Private Vault.\");\r\n\r\n  const client = await clientPromise;\r\n  const db = client.db(\"mirrorDB\");\r\n  const userId = session.user.id;\r\n\r\n  // 1. CALCULATE SOCIAL STREAK\r\n  const historyDates = await db.collection(\"chat_history\").aggregate([\r\n    { $match: { userId } },\r\n    { $project: { date: { $dateToString: { format: \"%Y-%m-%d\", date: \"$timestamp\" } } } },\r\n    { $group: { _id: \"$date\" } },\r\n    { $sort: { _id: -1 } }\r\n  ]).toArray();\r\n\r\n  let streak = 0;\r\n  if (historyDates.length > 0) {\r\n    const today = new Date().toISOString().split('T')[0];\r\n    const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];\r\n    let expectedDate = historyDates[0]._id === today ? today : yesterday;\r\n\r\n    for (const entry of historyDates) {\r\n      if (entry._id === expectedDate) {\r\n        streak++;\r\n        expectedDate = new Date(new Date(expectedDate).getTime() - 86400000).toISOString().split('T')[0];\r\n      } else break;\r\n    }\r\n  }\r\n\r\n  // 2. FETCH GROWTH METRICS & HISTORY\r\n  const stats = await db.collection(\"chat_history\").aggregate([\r\n    { $match: { userId } },\r\n    {\r\n      $facet: {\r\n        \"totals\": [{ $group: { _id: null, count: { $sum: 1 } } }],\r\n        \"recentHistory\": [\r\n          { $sort: { timestamp: -1 } },\r\n          { $limit: 5 },\r\n          { $project: { scenarioId: 1, lifeStage: 1, timestamp: 1, isPractice: 1 } }\r\n        ]\r\n      }\r\n    }\r\n  ]).toArray();\r\n\r\n  const totalSessions = stats[0].totals[0]?.count || 0;\r\n\r\n  // --- SERIALIZATION LAYER ---\r\n  // We package the data into a plain object and use the JSON trick \r\n  // to convert ObjectIds and Dates into simple strings.\r\n  const rawData = {\r\n    streak,\r\n    socialComfort: totalSessions > 5 ? \"+28%\" : \"+5%\",\r\n    interactionMaturity: (totalSessions * 0.4).toFixed(1),\r\n    perspectiveInsight: totalSessions > 10 ? \"+65%\" : \"+12%\",\r\n    totalScenarios: totalSessions,\r\n    history: stats[0].recentHistory || []\r\n  };\r\n\r\n  return JSON.parse(JSON.stringify(rawData));\r\n}"],"names":[],"mappings":";;;;;AAEA;AACA;;;;;AAEO,eAAe;IACpB,MAAM,UAAU,MAAM,IAAA,mHAAI;IAC1B,IAAI,CAAC,SAAS,MAAM,MAAM,IAAI,MAAM;IAEpC,MAAM,SAAS,MAAM,gIAAa;IAClC,MAAM,KAAK,OAAO,EAAE,CAAC;IACrB,MAAM,SAAS,QAAQ,IAAI,CAAC,EAAE;IAE9B,6BAA6B;IAC7B,MAAM,eAAe,MAAM,GAAG,UAAU,CAAC,gBAAgB,SAAS,CAAC;QACjE;YAAE,QAAQ;gBAAE;YAAO;QAAE;QACrB;YAAE,UAAU;gBAAE,MAAM;oBAAE,eAAe;wBAAE,QAAQ;wBAAY,MAAM;oBAAa;gBAAE;YAAE;QAAE;QACpF;YAAE,QAAQ;gBAAE,KAAK;YAAQ;QAAE;QAC3B;YAAE,OAAO;gBAAE,KAAK,CAAC;YAAE;QAAE;KACtB,EAAE,OAAO;IAEV,IAAI,SAAS;IACb,IAAI,aAAa,MAAM,GAAG,GAAG;QAC3B,MAAM,QAAQ,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;QACpD,MAAM,YAAY,IAAI,KAAK,KAAK,GAAG,KAAK,UAAU,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;QAC7E,IAAI,eAAe,YAAY,CAAC,EAAE,CAAC,GAAG,KAAK,QAAQ,QAAQ;QAE3D,KAAK,MAAM,SAAS,aAAc;YAChC,IAAI,MAAM,GAAG,KAAK,cAAc;gBAC9B;gBACA,eAAe,IAAI,KAAK,IAAI,KAAK,cAAc,OAAO,KAAK,UAAU,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;YAClG,OAAO;QACT;IACF;IAEA,oCAAoC;IACpC,MAAM,QAAQ,MAAM,GAAG,UAAU,CAAC,gBAAgB,SAAS,CAAC;QAC1D;YAAE,QAAQ;gBAAE;YAAO;QAAE;QACrB;YACE,QAAQ;gBACN,UAAU;oBAAC;wBAAE,QAAQ;4BAAE,KAAK;4BAAM,OAAO;gCAAE,MAAM;4BAAE;wBAAE;oBAAE;iBAAE;gBACzD,iBAAiB;oBACf;wBAAE,OAAO;4BAAE,WAAW,CAAC;wBAAE;oBAAE;oBAC3B;wBAAE,QAAQ;oBAAE;oBACZ;wBAAE,UAAU;4BAAE,YAAY;4BAAG,WAAW;4BAAG,WAAW;4BAAG,YAAY;wBAAE;oBAAE;iBAC1E;YACH;QACF;KACD,EAAE,OAAO;IAEV,MAAM,gBAAgB,KAAK,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,EAAE,SAAS;IAEnD,8BAA8B;IAC9B,kEAAkE;IAClE,sDAAsD;IACtD,MAAM,UAAU;QACd;QACA,eAAe,gBAAgB,IAAI,SAAS;QAC5C,qBAAqB,CAAC,gBAAgB,GAAG,EAAE,OAAO,CAAC;QACnD,oBAAoB,gBAAgB,KAAK,SAAS;QAClD,gBAAgB;QAChB,SAAS,KAAK,CAAC,EAAE,CAAC,aAAa,IAAI,EAAE;IACvC;IAEA,OAAO,KAAK,KAAK,CAAC,KAAK,SAAS,CAAC;AACnC;;;IA5DsB;;AAAA,+OAAA"}},
    {"offset": {"line": 234, "column": 0}, "map": {"version":3,"sources":["file:///D:/conversational-mirror-asd/.next-internal/server/app/%28dashboard%29/dashboard/analytics/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getOverallAnalytics as '0014052bf495dd0b685d64ad62e586c74101f6928d'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}